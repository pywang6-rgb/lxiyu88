<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›´æ’­æ’­æ”¾å™¨ - HLSç›´æ’­æµ</title>
    <!-- å¼•å…¥HLS.jsåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
        }
        
        .player-container {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            margin-bottom: 30px;
            position: relative;
        }
        
        .video-wrapper {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 å®½é«˜æ¯” */
            background: #000;
        }
        
        #videoPlayer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            outline: none;
        }
        
        .player-controls {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            transition: opacity 0.3s;
        }
        
        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            margin-right: 15px;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .progress-container {
            flex-grow: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin: 0 15px;
            cursor: pointer;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: #ff5722;
            border-radius: 4px;
            width: 0%;
        }
        
        .time-display {
            font-size: 0.9rem;
            white-space: nowrap;
            margin: 0 10px;
        }
        
        .volume-container {
            display: flex;
            align-items: center;
            margin-left: 10px;
        }
        
        .volume-slider {
            width: 80px;
            margin-left: 10px;
        }
        
        .quality-selector {
            margin-left: 15px;
            position: relative;
        }
        
        .quality-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .quality-menu {
            position: absolute;
            bottom: 100%;
            left: 0;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 5px;
            padding: 5px 0;
            display: none;
            min-width: 100px;
        }
        
        .quality-menu.show {
            display: block;
        }
        
        .quality-option {
            padding: 8px 15px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .quality-option:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .player-info {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .player-info h2 {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .info-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
        }
        
        .info-label {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .info-value {
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .status {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .status.success {
            background: rgba(76, 175, 80, 0.3);
            border-left: 4px solid #4caf50;
        }
        
        .status.error {
            background: rgba(244, 67, 54, 0.3);
            border-left: 4px solid #f44336;
        }
        
        .status.loading {
            background: rgba(255, 152, 0, 0.3);
            border-left: 4px solid #ff9800;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .volume-slider {
                width: 60px;
            }
            
            .player-controls {
                flex-wrap: wrap;
            }
            
            .progress-container {
                order: 1;
                width: 100%;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>HLSç›´æ’­æ’­æ”¾å™¨</h1>
            <p class="subtitle">æ­£åœ¨æ’­æ”¾20251101</p>
        </header>
        
        <div class="player-container">
            <div class="video-wrapper">
                <video id="videoPlayer" controls></video>
            </div>
            
            <div class="player-controls">
                <button class="control-btn" id="playPauseBtn">â¸ï¸</button>
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <span class="time-display" id="timeDisplay">00:00:00</span>
                
                <div class="volume-container">
                    <button class="control-btn" id="muteBtn">ğŸ”Š</button>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.1" value="1">
                </div>
                
                <div class="quality-selector">
                    <button class="quality-btn" id="qualityBtn">ç”»è´¨</button>
                    <div class="quality-menu" id="qualityMenu">
                        <div class="quality-option" data-quality="auto">è‡ªåŠ¨</div>
                        <div class="quality-option" data-quality="high">é«˜æ¸…</div>
                        <div class="quality-option" data-quality="medium">æ ‡æ¸…</div>
                        <div class="quality-option" data-quality="low">æµç•…</div>
                    </div>
                </div>
                
                <button class="control-btn" id="fullscreenBtn">â›¶</button>
            </div>
        </div>
        
        <div class="player-info">
            <h2>ç›´æ’­ä¿¡æ¯</h2>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">ç›´æ’­æº</div>
                    <div class="info-value">HLS ç›´æ’­æµ</div>
                </div>
                <div class="info-item">
                    <div class="info-label">æ’­æ”¾åœ°å€</div>
                    <div class="info-value">http://218.71.2.58:9011//hls/test.m3u8</div>
                </div>
                <div class="info-item">
                    <div class="info-label">æ’­æ”¾çŠ¶æ€</div>
                    <div class="info-value" id="playStatus">å‡†å¤‡æ’­æ”¾</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ç¼“å†²çŠ¶æ€</div>
                    <div class="info-value" id="bufferStatus">--</div>
                </div>
            </div>
        </div>
        
        <div class="status" id="connectionStatus">
            <span class="loading-spinner"></span>æ­£åœ¨è¿æ¥ç›´æ’­æµ...
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const video = document.getElementById('videoPlayer');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const progressBar = document.getElementById('progressBar');
            const progressContainer = document.getElementById('progressContainer');
            const timeDisplay = document.getElementById('timeDisplay');
            const muteBtn = document.getElementById('muteBtn');
            const volumeSlider = document.getElementById('volumeSlider');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const playStatus = document.getElementById('playStatus');
            const bufferStatus = document.getElementById('bufferStatus');
            const connectionStatus = document.getElementById('connectionStatus');
            const qualityBtn = document.getElementById('qualityBtn');
            const qualityMenu = document.getElementById('qualityMenu');
            
            let hls;
            let isLive = true; // ç›´æ’­æµæ²¡æœ‰å›ºå®šæ—¶é•¿
            
            // åˆå§‹åŒ–HLSæ’­æ”¾å™¨
            function initHLS() {
                if (Hls.isSupported()) {
                    hls = new Hls({
                        enableWorker: false,
                        lowLatencyMode: true,
                        backBufferLength: 90
                    });
                    
                    // ç»‘å®šHLSåˆ°videoå…ƒç´ 
                    hls.loadSource('http://218.71.2.58:9011/hls/test.m3u8');
                    hls.attachMedia(video);
                    
                    // HLSäº‹ä»¶ç›‘å¬
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        console.log('ç›´æ’­æµåŠ è½½æˆåŠŸ');
                        connectionStatus.textContent = 'âœ… ç›´æ’­æµè¿æ¥æˆåŠŸ';
                        connectionStatus.className = 'status success';
                        playStatus.textContent = 'å·²è¿æ¥ï¼Œå‡†å¤‡æ’­æ”¾';
                        
                        // è‡ªåŠ¨å¼€å§‹æ’­æ”¾
                        video.play().catch(e => {
                            console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', e);
                            playStatus.textContent = 'ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¼€å§‹';
                        });
                    });
                    
                    hls.on(Hls.Events.ERROR, function(event, data) {
                        console.error('HLSé”™è¯¯:', data);
                        if (data.fatal) {
                            switch(data.type) {
                                case Hls.ErrorTypes.NETWORK_ERROR:
                                    connectionStatus.textContent = 'âŒ ç½‘ç»œé”™è¯¯: ' + data.details;
                                    connectionStatus.className = 'status error';
                                    break;
                                case Hls.ErrorTypes.MEDIA_ERROR:
                                    connectionStatus.textContent = 'âŒ åª’ä½“é”™è¯¯: ' + data.details;
                                    connectionStatus.className = 'status error';
                                    break;
                                default:
                                    connectionStatus.textContent = 'âŒ ä¸å¯æ¢å¤çš„é”™è¯¯';
                                    connectionStatus.className = 'status error';
                                    hls.destroy();
                                    break;
                            }
                        }
                    });
                    
                    hls.on(Hls.Events.LEVEL_LOADED, function(event, data) {
                        console.log('æ¸…æ™°åº¦åˆ‡æ¢:', data);
                    });
                    
                    hls.on(Hls.Events.BUFFER_CREATED, function(event, data) {
                        updateBufferStatus();
                    });
                    
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    // SafariåŸç”Ÿæ”¯æŒHLS
                    video.src = 'http://218.71.2.58:9011/hls/test.m3u8';
                    video.addEventListener('loadedmetadata', function() {
                        connectionStatus.textContent = 'âœ… ç›´æ’­æµè¿æ¥æˆåŠŸ';
                        connectionStatus.className = 'status success';
                        playStatus.textContent = 'å·²è¿æ¥ï¼Œå‡†å¤‡æ’­æ”¾';
                    });
                } else {
                    connectionStatus.textContent = 'âŒ æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒHLSç›´æ’­æµæ’­æ”¾';
                    connectionStatus.className = 'status error';
                }
            }
            
            // æ’­æ”¾/æš‚åœæ§åˆ¶
            playPauseBtn.addEventListener('click', function() {
                if (video.paused) {
                    video.play();
                    playPauseBtn.textContent = 'â¸ï¸';
                    playStatus.textContent = 'æ’­æ”¾ä¸­';
                } else {
                    video.pause();
                    playPauseBtn.textContent = 'â–¶ï¸';
                    playStatus.textContent = 'å·²æš‚åœ';
                }
            });
            
            // æ›´æ–°è¿›åº¦æ¡ (ç›´æ’­æµç‰¹æ®Šå¤„ç†)
            video.addEventListener('timeupdate', function() {
                if (isLive) {
                    // ç›´æ’­æµæ˜¾ç¤ºå½“å‰æ—¶é—´
                    const currentTime = formatTime(video.currentTime);
                    timeDisplay.textContent = currentTime;
                    
                    // ç›´æ’­æµè¿›åº¦æ¡ç‰¹æ®Šå¤„ç†
                    if (video.duration && video.duration !== Infinity) {
                        const progress = (video.currentTime / video.duration) * 100;
                        progressBar.style.width = `${progress}%`;
                    } else {
                        // å¯¹äºæ— é™ç›´æ’­æµï¼Œè¿›åº¦æ¡ä¿æŒæ»¡çŠ¶æ€
                        progressBar.style.width = `100%`;
                    }
                } else {
                    // ç‚¹æ’­è§†é¢‘å¤„ç†
                    const progress = (video.currentTime / video.duration) * 100;
                    progressBar.style.width = `${progress}%`;
                    
                    const currentTime = formatTime(video.currentTime);
                    const duration = formatTime(video.duration);
                    timeDisplay.textContent = `${currentTime} / ${duration}`;
                }
            });
            
            // ç‚¹å‡»è¿›åº¦æ¡è·³è½¬ (ç›´æ’­æµç¦ç”¨)
            progressContainer.addEventListener('click', function(e) {
                if (!isLive) {
                    const rect = progressContainer.getBoundingClientRect();
                    const pos = (e.clientX - rect.left) / rect.width;
                    video.currentTime = pos * video.duration;
                }
            });
            
            // éŸ³é‡æ§åˆ¶
            volumeSlider.addEventListener('input', function() {
                video.volume = volumeSlider.value;
                updateVolumeIcon();
            });
            
            muteBtn.addEventListener('click', function() {
                video.muted = !video.muted;
                updateVolumeIcon();
            });
            
            function updateVolumeIcon() {
                if (video.muted || video.volume === 0) {
                    muteBtn.textContent = 'ğŸ”‡';
                } else if (video.volume < 0.5) {
                    muteBtn.textContent = 'ğŸ”ˆ';
                } else {
                    muteBtn.textContent = 'ğŸ”Š';
                }
                volumeSlider.value = video.muted ? 0 : video.volume;
            }
            
            // å…¨å±æ§åˆ¶
            fullscreenBtn.addEventListener('click', function() {
                if (!document.fullscreenElement) {
                    video.requestFullscreen().catch(err => {
                        console.error(`å…¨å±è¯·æ±‚é”™è¯¯: ${err.message}`);
                    });
                } else {
                    document.exitFullscreen();
                }
            });
            
            // ç”»è´¨é€‰æ‹©
            qualityBtn.addEventListener('click', function() {
                qualityMenu.classList.toggle('show');
            });
            
            // å…³é—­ç”»è´¨èœå•å½“ç‚¹å‡»å…¶ä»–åœ°æ–¹æ—¶
            document.addEventListener('click', function(e) {
                if (!qualityBtn.contains(e.target) && !qualityMenu.contains(e.target)) {
                    qualityMenu.classList.remove('show');
                }
            });
            
            // ç”»è´¨é€‰é¡¹ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.quality-option').forEach(option => {
                option.addEventListener('click', function() {
                    const quality = this.getAttribute('data-quality');
                    // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥åˆ‡æ¢ä¸åŒçš„HLSçº§åˆ«
                    console.log('åˆ‡æ¢åˆ°ç”»è´¨:', quality);
                    qualityBtn.textContent = `ç”»è´¨: ${this.textContent}`;
                    qualityMenu.classList.remove('show');
                });
            });
            
            // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
            function formatTime(seconds) {
                const hrs = Math.floor(seconds / 3600);
                const mins = Math.floor((seconds % 3600) / 60);
                const secs = Math.floor(seconds % 60);
                return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            // æ›´æ–°ç¼“å†²çŠ¶æ€
            function updateBufferStatus() {
                if (video.buffered && video.buffered.length > 0) {
                    const bufferedEnd = video.buffered.end(video.buffered.length - 1);
                    const bufferPercentage = (bufferedEnd / video.duration) * 100;
                    bufferStatus.textContent = `${Math.round(bufferPercentage)}% å·²ç¼“å†²`;
                } else {
                    bufferStatus.textContent = '0% å·²ç¼“å†²';
                }
            }
            
            // è§†é¢‘äº‹ä»¶ç›‘å¬
            video.addEventListener('waiting', function() {
                playStatus.textContent = 'ç¼“å†²ä¸­...';
            });
            
            video.addEventListener('playing', function() {
                playStatus.textContent = 'æ’­æ”¾ä¸­';
            });
            
            video.addEventListener('ended', function() {
                playPauseBtn.textContent = 'â–¶ï¸';
                playStatus.textContent = 'æ’­æ”¾ç»“æŸ';
            });
            
            // æ£€æµ‹æ˜¯å¦ä¸ºç›´æ’­æµ
            video.addEventListener('loadedmetadata', function() {
                isLive = !isFinite(video.duration);
                console.log('æ˜¯å¦ä¸ºç›´æ’­æµ:', isLive);
                
                if (isLive) {
                    timeDisplay.textContent = 'ç›´æ’­';
                    progressBar.style.width = '100%';
                }
            });
            
            // åˆå§‹åŒ–HLSæ’­æ”¾å™¨
            initHLS();
        });
    </script>
</body>
</html>
